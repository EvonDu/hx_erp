<?phpinclude_once(dirname(BASEPATH).'/inherit/BaseModel.php');class AllocateItem_model extends BaseModel{    /**     * @var table     */    protected $table = "t_sell_allocate_item";    protected $pk = "id";    /**     * @fields     */    public $id,$allocate_id,$form_id,$form_spu_id,$form_sku_id,$spu_id,$sku_id,$num,$status;    /**     * @return object     */    static function describe(){        $data = (object)array();        $data->desc = "AllocateItem";        $data->name = "报货单项";        return $data;    }    /**     * @return array     */    static function attributeLabels()    {        return [            "id"=>"ID",            "allocate_id"=>"配货单ID",            "form_id"=>"销售单ID",            "form_spu_id"=>"销售单SPU",//sku项            "form_sku_id"=>"销售单SKU",//sku项            "spu_id"=>"SPU",            "sku_id"=>"SKU",            "num"=>"报货数量",            "status"=>"状态",        ];    }    /**     * 获取配货状态,返回key-value     * @param $form_id     * @return array     */    public function getAllocateStatus($form_id){        //定义条件        $select = "form_sku_id";        $select_sum = "num";        $condition = array("form_id"=>$form_id);        $groupby = array("form_sku_id");        //转义        $select_esc = $this->addPrefixField($select);        $select_sum_esc = $this->addPrefixField($select_sum);        $condition = $this->addPrefixKeyValue($condition);        $groupby = $this->addPrefixFields($groupby);        //查询已经配数量        $query = $this->db            ->select($select_esc)            ->select_sum($select_sum_esc)            ->where($condition)            ->group_by($groupby)            ->get($this->table);        $list = $query->result();        //重整理成key/value形式        $result = array();        foreach($list as $item){            $result[$item->{$select}] = $item->{$select_sum};        }        //返回        return $result;    }}?>    